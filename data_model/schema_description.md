# Energy Demand and Supply Data Pipeline - Schema Description

### **1. `date` Table**
- **`date_key`** (PK): Surrogate key generated by `dbt_utils.generate_surrogate_key(['date_day'])`
- **`date_day`**: The date in `YYYY-MM-DD` format (from `period_ts`).
- **`year`**: The year extracted from `period_ts`.
- **`month`**: The month extracted from `period_ts`.
- **`day`**: The day of the month extracted from `period_ts`.
- **`hour`**: The hour of the day extracted from `period_ts`.

### **2. `demand` Table**
- **`demand_sk`** (PK): Surrogate key generated by `dbt_utils.generate_surrogate_key(['type_short', 'respondent', 'period_ts'])`
- **`period_ts`**: Timestamp indicating the period of the demand.
- **`type_short`**: Short code for the demand type.
- **`type_name`**: Full name of the demand type.
- **`respondent`**: Identifier for the respondent.
- **`respondent_name`**: Name of the respondent.
- **`value_mwh`**: The demand value in MWh.
- **`value_units`**: Units of the demand value (e.g., MWh).

### **3. `energy_source` Table**
- **`energy_source_key`** (PK): Surrogate key generated by `dbt_utils.generate_surrogate_key(['fuel_type', 'date_energy_source', 'respondent_code'])`
- **`date_energy_source`**: The date of the energy source record.
- **`fuel_type`**: The type of fuel used for energy generation.
- **`fuel_type_name`**: Full name of the fuel type.
- **`respondent_code`**: Code for the respondent.
- **`value_mwh`**: The energy generation value in MWh.

### **4. `respondent` Table**
- **`respondent_code`** (PK): The respondent's unique code.
- **`respondent_name`**: The respondent's name.

### **5. `subregion` Table** 
- **`date_subregion`** (PK): The date of the subregion data.
- **`subregion_key`**: Surrogate key generated by `dbt_utils.generate_surrogate_key(['subregion_code', 'date_subregion'])`
- **`subregion_code`**: Code for the subregion.
- **`subregion_name`**: Name of the subregion.
- **`parent_region_code`**: Code for the parent region.
- **`parent_region_name`**: Name of the parent region.
- **`value_mwh`**: The energy demand value for the subregion in MWh.

### **6. `daily_total_demand` Fact Table**  
- **`fact_demand_key`** (PK): Surrogate key generated by `dbt_utils.generate_surrogate_key(['date_1'])`
- **`period_date`**: The date of the demand record.
- **`total_demand_mwh`**: The total energy demand in MWh.

### **7. `daily_total_source` Fact Table**
- **`fact_energy_key`** (PK): Surrogate key generated by `dbt_utils.generate_surrogate_key(['date_energy_source'])`
- **`date_energy_source`**: The date of the energy source record.
- **`total_energy_value`**: The total energy generation value in MWh.

### **8. `demand_supply_diff` Fact Table**
- **`surrogate_key`** (PK): Surrogate key generated by `dbt_utils.generate_surrogate_key(['fact_demand_key', 'period_date'])`
- **`fact_demand_key`**: Foreign key linking to `fact_daily_total_demand`.
- **`period_date`**: The date for the demand-supply difference record.
- **`total_demand_mwh`**: The total energy demand in MWh.
- **`total_energy_value`**: The total energy generation value in MWh.
- **`net_diff`**: The difference between demand and supply (i.e., `total_demand_mwh - total_energy_value`).
- **`start_date`**: The start date when the record is valid (defaults to `CURRENT_DATE`).
- **`end_date`**: The end date when the record becomes invalid (defaults to `NULL` for current records).
- **`is_current`**: A flag to indicate if the record is the current version (set to `1` for the current record).

## **Relationships**
- The `demand`, `energy_source`, and `subregion` tables link to the `respondent` table via the `respondent_code` (or `respondent_key` in the `dim_respondent` table).
- The `daily_total_demand` and `daily_total_source` tables represent aggregated facts, with the `demand_supply_diff` table capturing the difference between these facts on a daily basis.
- The `date` table is used to reference individual dates across the entire model, linking all facts to a common time dimension.

